<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Video Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= BASE ================= */
body {
  margin: 0;
  background: #0b0b0b;
  color: #ffffff;
  font-family: system-ui, -apple-system, Arial, sans-serif;
}

/* ================= HEADER ================= */
.header {
  text-align: center;
  padding: 16px;
  font-size: 18px;
  font-weight: 600;
  background: #000;
  border-bottom: 1px solid #1e1e1e;
}

/* ================= APP ================= */
.app {
  padding: 14px;
}

/* ================= INPUT ================= */
.input-box {
  background: #141414;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 14px;
}

input {
  width: 100%;
  background: transparent;
  border: none;
  outline: none;
  color: #fff;
  font-size: 15px;
}

/* ================= BOTÕES ================= */
.btn {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
  font-weight: 500;
  color: #fff;
  margin-bottom: 12px;
}

.btn-play {
  background: #1e88e5;
}

.btn-download {
  background: #2e7d32;
}

/* ================= PLAYER ================= */
.player-box {
  background: #000;
  border-radius: 14px;
  overflow: hidden;
  margin-bottom: 14px;
  box-shadow: 0 8px 20px rgba(0,0,0,.6);
}

video {
  width: 100%;
  max-height: 60vh;
  background: #000;
}

/* ================= HISTÓRICO ================= */
.section-title {
  font-size: 14px;
  margin: 18px 0 10px;
  color: #bdbdbd;
}

.history-item {
  background: #141414;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 8px;
  font-size: 13px;
  color: #ddd;
  cursor: pointer;
  word-break: break-all;
}

.history-item:hover {
  background: #1f1f1f;
}

/* ================= MODAL ================= */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.75);
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.modal-content {
  background: #121212;
  border-radius: 12px;
  padding: 20px;
  width: 85%;
  text-align: center;
}

.modal-content h3 {
  margin-top: 0;
  font-size: 16px;
}

.modal-content p {
  font-size: 14px;
  color: #ccc;
}

.modal-content button {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 14px;
  color: #fff;
}

.btn-browser {
  background: #1e88e5;
}

.btn-close {
  background: #444;
}
</style>
</head>

<body>

<div class="header">Video Player</div>

<div class="app">

  <div class="input-box">
    <input id="videoUrl" placeholder="Cole o link direto do vídeo MP4">
  </div>

  <button class="btn btn-play" id="playBtn">Assistir</button>

  <div class="player-box">
    <video id="player" controls></video>
  </div>

  <button class="btn btn-download" id="downloadBtn">Baixar vídeo</button>

  <div class="section-title">Histórico</div>
  <div id="history"></div>

</div>

<!-- ================= MODAL ================= -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Link expirado ou indisponível</h3>
    <p>Este vídeo não está mais disponível. Cole o link novamente ou abra no navegador.</p>
    <button class="btn-browser" id="openBrowser">Abrir no navegador</button>
    <button class="btn-close" id="closeModal">Fechar</button>
  </div>
</div>

<script>
const input = document.getElementById("videoUrl");
const playBtn = document.getElementById("playBtn");
const downloadBtn = document.getElementById("downloadBtn");
const player = document.getElementById("player");
const historyBox = document.getElementById("history");

const modal = document.getElementById("modal");
const openBrowser = document.getElementById("openBrowser");
const closeModal = document.getElementById("closeModal");

let history = JSON.parse(localStorage.getItem("videoHistory")) || [];

function saveHistory(url) {
  history = history.filter(item => item !== url);
  history.unshift(url);
  history = history.slice(0, 10);
  localStorage.setItem("videoHistory", JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  historyBox.innerHTML = "";
  history.forEach(url => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.textContent = url;
    div.onclick = () => testAndPlay(url);
    historyBox.appendChild(div);
  });
}

async function testAndPlay(url) {
  try {
    const res = await fetch(url, { method: "HEAD" });
    if (!res.ok) throw new Error();
    playVideo(url);
  } catch {
    modal.style.display = "flex";
    openBrowser.onclick = () => window.open(url, "_blank");
  }
}

function playVideo(url) {
  player.src = url;
  player.play();
  input.value = url;
  saveHistory(url);
}

playBtn.onclick = () => {
  const url = input.value.trim();
  if (!url) return alert("Cole um link primeiro.");
  testAndPlay(url);
};

downloadBtn.onclick = () => {
  const url = player.src;
  if (!url) return alert("Nenhum vídeo carregado.");

  const a = document.createElement("a");
  a.href = url;
  a.download = "";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  setTimeout(() => modal.style.display = "flex", 1200);
  openBrowser.onclick = () => window.open(url, "_blank");
};

closeModal.onclick = () => modal.style.display = "none";

renderHistory();
</script>

</body>
</html>